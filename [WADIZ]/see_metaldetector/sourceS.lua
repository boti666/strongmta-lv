local lockCode = "KrisztianBalazs2022"
local lockString = 655

local fileType = ".dff"

function lockFile(path, key, fileName)
	local file = fileOpen(path)
	local size = fileGetSize(file)
	local FirstPart = fileRead(file, lockString)
	fileSetPos(file, lockString)
	local SecondPart = fileRead(file, size-lockString)
	fileClose(file)
	file = fileCreate(utf8.gsub("files/" .. fileName, fileType, "") .. ".wardis")
	fileWrite(file, encodeString("tea", FirstPart, { key = key }) .. SecondPart)
	fileClose(file)
    outputDebugString("[encode]: 'mods/" .. fileName .. ".wardis' created.")
	return true
end

addCommandHandler("encodemodels",
	function (player, cmd, ...)

		if getElementData(player, "acc.adminLevel") >= 7 then
			print("asdsd")
			local names = {...}

			if string.len(#names) > 0 then
				for k, v in pairs(names) do
                    local data = ""

					if fileExists("files/serverFiles/" .. v .. ".dff") then
						lockFile("files/serverFiles/" .. v .. ".dff", lockCode, v)
					end
				
				end
			else
				outputChatBox("#ff4646[StrongMTA]: [modell neve]", player, 255, 255, 255, true)
			end
		end
	end
)


local detectorPos = {
	{337.71090698242, 1909.7927246094, 17.640625},
	{285.74212646484, 2045.5852050781, 17.640625},
	{194.72010803223, 1975.5455322266, 17.640625},
	{112.44073486328, 1957.2078857422, 18.9498462677},
	{74.555686950684, 1866.7713623047, 17.640625},
	{48.744003295898, 1727.8814697266, 17.640625},
	{-53.530624389648, 1680.9005126953, 17.762168884277},
	{155.19400024414, 1601.4215087891, 33.374359130859},
	{257.97674560547, 1588.5690917969, 24.449573516846},
	{299.75689697266, 1482.8619384766, 9.7936935424805},
	{486.47186279297, 1516.80859375, 1},
	{498.4328918457, 1413.0313720703, 3.8959159851074},
	{304.1403503418, 1323.0228271484, 10.865629196167},
	{-114.92896270752, 1362.0385742188, 9.1890830993652},
	{-164.31420898438, 1577.5473632812, 17.011396408081},
	{-101.89087677002, 1925.2994384766, 18.277263641357},
	{-116.42482757568, 1976.7697753906, 24.962493896484},
	{-90.693412780762, 2000.1103515625, 20.571517944336},
	{-23.873525619507, 2036.0318603516, 17.640625},
	{7.8048377037048, 2091.8564453125, 17.728046417236},
	{96.523056030273, 2115.8364257812, 18.053382873535},
	{100.87331390381, 2059.08203125, 17.880586624146},
	{163.42691040039, 1992.0886230469, 18.737203598022},
	{226.03443908691, 1721.1101074219, 20.617444992065},
	{-343.51477050781, 1754.8629150391, 42.71482467651},
	{-295.25967407227, 1804.7620849609, 42.78125},
	{-308.43359375, 1722.2237548828, 42.747745513916},
	{-249.88410949707, 1302.9333496094, 33.627883911133},
	{-136.19787597656, 1266.2453613281, 19.464084625244},
	{-1.5590668916702, 1360.4586181641, 9.171875},
	{28.173540115356, 1397.8488769531, 10.050721168518},
	{87.870109558105, 1452.8081054688, 10.942988395691},
	{329.88967895508, 1587.52734375, 27.357074737549},
	{556.92730712891, 1573.5404052734, 1.3722457885742},
	{506.36322021484, 1508.4399414062, 1},
	{559.81427001953, 1494.7613525391, 2.2747015953064},
	{647.59930419922, 1637.5456542969, 7.4056768417358},
	{885.81225585938, 852.32580566406, 13.3515625},
	{832.62902832031, 827.78674316406, 12.138670921326},
	{869.99639892578, 805.80511474609, 17.46312713623},
	{846.62103271484, 883.35870361328, 13.351562},
	{885.01208496094, 953.94525146484, 12.414611816406},
	{947.94897460938, 961.033203125, 13.167402267456},
	{940.19451904297, 1105.7932128906, 11.715622901917},
	{790.00445556641, 848.14868164062, 6.1781568527222},
	{784.16259765625, 817.24945068359, 5.1615571975708},
	{805.18719482422, 826.40808105469, 9.0233535766602},
	{880.59545898438, 1002.8562011719, 14.835115432739},

	{-26.205877304077, 1734.8723144531, 16.690475463867},
	{-24.753963470459, 1901.2908935547, 17.647617340088},
	{70.506149291992, 2042.2469482422, 17.677152633667},
	{456.08514404297, 1833.5207519531, 24.246074676514},
	{192.82286071777, 2125.2431640625, 17.431936264038},
	{567.92645263672, 1842.7110595703, 30.977838516235},
	{596.95343017578, 1991.8177490234, 61.451583862305},
	{489.28811645508, 2280.2741699219, 39.461818695068},
	{404.1559753418, 2285.8793945312, 40.192306518555},
	{342.78909301758, 2218.4011230469, 38.682739257812},
	{-149.79566955566, 1889.7431640625, 41.93221282959},
	{-155.63356018066, 1789.6547851562, 53.922718048096},
	{20.331758499146, 1560.97265625, 12.75},
	{52.827903747559, 1534.4831542969, 12.75},
	{96.337120056152, 1527.9304199219, 14.925045013428},
}

for k, v in ipairs(detectorPos) do
    boxObject = createObject(2969, v[1], v[2], v[3] - 1)
    setElementData(boxObject, "isMetalBox", true)
    setElementData(boxObject, "isLotting", true)
    setElementData(boxObject, "alphaTick", 0)
    setElementData(boxObject, "secondState", false)
    setElementAlpha(boxObject, 0)
    setElementData(boxObject, "box.ID", k)
end

local holes = {}
local num = 0
local timers = {}

addEvent("syncHoles", true)
addEventHandler("syncHoles", getRootElement(),
	function(obj, box)
		num = num + 1

		local posX, posY, posZ = getElementPosition(box)
		holes[num] = createObject(5136, posX, posY, posZ + 0.5)
		setElementCollisionsEnabled(holes[num], false)
		setObjectScale(holes[num], 0.5)



		timers[num] = setTimer(function(num, box)
			destroyElement(holes[num])

			setElementData(box, "isMetalBox", true)
		    setElementData(box, "isLotting", true)
		    setElementData(box, "alphaTick", 0)
		    setElementData(box, "secondState", false)
		    setElementAlpha(box, 0)
		end, (1000 * 60) * 120, 1, num, box)
	end
)

addEvent("getItemToPlayer", true)
addEventHandler("getItemToPlayer", getRootElement(), 
	function(itemID)
		exports.see_items:giveItem(source, itemID, 1)
	end
)